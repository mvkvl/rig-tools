#!/usr/bin/env python3

import conf
import config
from optparse import OptionParser
from crypto import PoolBalance as PoolBalance

if __name__ == '__main__':

    # gets program arguments
    def get_program_arguments():
        parser = OptionParser()
        parser.add_option("-c", "--config", dest="config",
                                            help="configuration file")
        (options, arguments) = parser.parse_args()
        return options, arguments

    opts, args = get_program_arguments()

    if not opts.config:
        raise ValueError("configuration file argument not passed")

    conf   = config.read(opts.config)
    result = PoolBalance(conf["pool"]).query()

    # print result to stdout if console output is enabled in configuration
    if config.plugin_enabled("output", "console", conf):
        import output.console
        output.console.output(result)

    # save result to influxdb if influxdb output is enabled in configuration
    if config.plugin_enabled("output", "influxdb", conf):
        import output.influxdb
        output.influxdb.save_pool_balance(result, conf["output"]["influxdb"],
                                                  metric="balance.pool")
